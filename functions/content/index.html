<html>

<body>
  <h1>Azure SignalR Serverless Sample</h1>
  <div id="messages"></div>
  <div id="users"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/3.1.7/signalr.min.js"></script>
  <script>
    let messages=document.querySelector('#messages')
    let viewed=false
    const apiBaseUrl=window.location.origin
    const connection=new signalR.HubConnectionBuilder()
      .withUrl(apiBaseUrl+'/api')
      .configureLogging(signalR.LogLevel.Information)
      .build()
    connection.on('newMessage',(message) => {
      document.getElementById("messages").innerHTML=message
    })

    connection.on('newView',(message) => {
      document.getElementById("users").innerHTML=message
      viewed=true
    })
    async function start () {
      try {
        await connection.start()
        console.log("SignalR Connected.")
        await connection.invoke('NewViewer','Greeting!')
        .catch(console.error);
      } catch(err) {
        console.log(err)
        setTimeout(start,5000)
      }
    };

    start();


  </script>
</body>

</html>