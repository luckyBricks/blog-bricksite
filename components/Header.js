import { useEffect, useRef } from 'react';
import Link from 'next/link';
import BLOG from '@/blog.config';
import { useLocale } from '@/lib/locale';
import ThemeToggler from './ThemeToggler';

const NavBar = () => {
  const locale = useLocale();
  const links = [
    { id: 0, name: locale.NAV.INDEX, to: BLOG.path || '/', show: true },
    { id: 1, name: locale.NAV.ABOUT, to: '/about', show: BLOG.showAbout },
    // { id: 2, name: locale.NAV.RSS, to: '/feed', show: true },
    { id: 3, name: locale.NAV.SEARCH, to: '/search', show: true },
  ];
  return (
    <div className="flex-shrink-0 flex gap-2">
      <ul className="flex flex-row items-center">
        {links.map(
          (link) =>
            link.show && (
              <li
                key={link.id}
                className="block ml-4 text-black dark:text-gray-50 nav hover:text-primary dark:hover:text-primary"
              >
                <Link href={link.to}>{link.name}</Link>
              </li>
            )
        )}
      </ul>
      <ThemeToggler />
    </div>
  );
};

const Header = ({ navBarTitle, fullWidth }) => {
  const useSticky = !BLOG.autoCollapsedNavBar;
  const navRef = useRef(null);
  const sentinalRef = useRef([]);
  const handler = ([entry]) => {
    if (navRef && navRef.current && useSticky) {
      if (!entry.isIntersecting && entry !== undefined) {
        navRef.current?.classList.add('sticky-nav-full');
      } else {
        navRef.current?.classList.remove('sticky-nav-full');
      }
    } else {
      navRef.current?.classList.add('remove-sticky');
    }
  };
  useEffect(() => {
    const obvserver = new window.IntersectionObserver(handler);
    obvserver.observe(sentinalRef.current);
    // Don't touch this, I have no idea how it works XD
    // return () => {
    //   if (sentinalRef.current) obvserver.unobserve(sentinalRef.current)
    // }
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [sentinalRef]);
  return (
    <>
      <div className="observer-element h-4 md:h-12" ref={sentinalRef}></div>
      <div
        className={`sticky-nav m-auto w-full h-6 flex flex-row justify-between items-center mb-2 md:mb-10 py-8 bg-opacity-60 ${
          !fullWidth ? 'max-w-3xl px-4' : 'px-4 md:px-24'
        }`}
        id="sticky-nav"
        ref={navRef}
      >
        <div className="flex items-center">
          <Link href="/" aria-label={BLOG.title}>
            <div className="h-6">
              <svg
                t="1683125427686"
                viewBox="800 300 400 400"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                p-id="1048"
                width="24"
                height="24"
                preserveAspectRatio="xMinYMin slice"
              >
                <path
                  d="M1024.113778 651.131259c8.277333 2.398815 16.990815 5.12 26.149926 8.173037 9.14963 3.053037 17.322667 6.096593 24.509629 9.14963 7.186963 3.053037 12.638815 5.888 16.346074 8.495407 3.707259 2.616889 4.247704 4.683852 1.630815 6.210371-6.968889 3.707259-16.175407 6.750815-27.619555 9.149629-11.434667 2.398815-23.969185 4.190815-37.584593 5.394963-13.615407 1.194667-27.676444 1.744593-42.164148 1.630815-14.487704-0.104296-28.112593-0.758519-40.855704-1.962667-12.743111-1.194667-24.073481-2.996148-33.991111-5.394963-9.91763-2.398815-17.047704-5.338074-21.409185-8.827259-2.398815-1.962667-1.744593-4.304593 1.962667-7.025778s9.092741-5.556148 16.175407-8.495407c7.082667-2.939259 15.141926-5.831111 24.187259-8.666074 9.045333-2.834963 17.701926-5.451852 25.97926-7.841185 3.925333-1.09037 6.921481-0.976593 8.988444 0.32237 2.066963 1.308444 4.02963 2.939259 5.878518 4.901926 1.848889 1.962667 4.143407 3.811556 6.864593 5.556148 2.721185 1.744593 6.703407 2.616889 11.927704 2.616889 5.233778 0 9.14963-0.872296 11.766518-2.616889 2.616889-1.744593 4.901926-3.593481 6.864593-5.556148 1.962667-1.962667 3.925333-3.593481 5.878518-4.901926 1.98163-1.298963 4.816593-1.403259 8.514371-0.312889zM930.635852 419.403852c-0.654222-1.526519-0.436148-2.939259 0.654222-4.247704 1.09037-1.308444 2.503111-2.503111 4.247704-3.593481 1.962667-1.09037 4.352-2.180741 7.186963-3.271111l-1.962667-3.925334c-0.872296-1.526519-1.962667-3.489185-3.271111-5.878518-1.308444-2.398815-2.834963-5.44237-4.579556-9.14963-1.962667-3.707259-2.673778-6.968889-2.123851-9.803852 0.540444-2.834963 1.848889-4.683852 3.925333-5.556148 2.066963-0.872296 4.522667-0.549926 7.35763 0.976593 2.834963 1.526519 5.556148 4.683852 8.173037 9.481481 2.616889 5.015704 6.267259 11.226074 10.951111 18.631111 4.683852 7.405037 9.424593 14.601481 14.222222 21.570371 5.660444 8.277333 11.548444 16.772741 17.645037 25.495703l20.916148-16.668444c-0.218074-2.398815-0.654222-4.901926-1.308444-7.518815-0.436148-2.398815-1.09037-5.015704-1.962667-7.841185-0.872296-2.834963-2.180741-5.878519-3.925333-9.14963-1.526519-3.053037-2.123852-5.992296-1.801482-8.827259 0.32237-2.834963 1.147259-4.958815 2.455704-6.371556 1.308444-1.412741 2.996148-2.019556 5.063111-1.792 2.066963 0.218074 3.972741 1.744593 5.717333 4.579556 1.744593 2.834963 3.754667 5.717333 6.049185 8.656593 2.285037 2.939259 4.408889 5.613037 6.371556 8.011851l7.186963 8.495408 31.706074-6.864593 5.233778 12.098371-17.645037 11.766518c-5.015704 3.271111-10.078815 6.58963-15.198815 9.974519-5.12 3.375407-9.424593 6.153481-12.913778 8.334222-3.489185 2.180741-7.082667 4.79763-10.789926 7.841185-3.707259 3.053037-7.082667 6.646519-10.135703 10.789926-3.053037 4.143407-5.556148 8.874667-7.518815 14.212741-1.962667 5.338074-2.939259 11.273481-2.939259 17.815703v25.163852l-0.654223 30.72V591.644444l0.654223 17.322667c0.436148 11.548444 1.308444 14.440296 2.616888 8.656593 1.308444-5.774222 2.721185-3.318519 4.247704 7.357629a84.821333 84.821333 0 0 0 5.556148 6.864593c-1.526519 2.180741-3.375407 4.247704-5.556148 6.21037-1.962667 1.744593-4.352 3.375407-7.186963 4.901926-2.834963 1.526519-6.21037 2.503111-10.135704 2.939259-3.925333 0.436148-7.461926 0.161185-10.619259-0.815407-3.157333-0.976593-5.935407-2.019556-8.334222-3.109926-2.616889-1.308444-5.015704-2.939259-7.186963-4.901926 0.872296-3.925333 1.744593-7.954963 2.616889-12.088889 0.654222-3.707259 1.251556-7.623111 1.801481-11.766518 0.540444-4.143407 0.815407-8.173037 0.815408-12.088889v-94.78637c0-5.878519 0.218074-11.652741 0.654222-17.322667 0.436148-5.660444 0.976593-10.676148 1.630815-15.03763 0.872296-5.224296 1.744593-10.135704 2.616889-14.705778-3.707259-6.750815-7.082667-12.743111-10.135704-17.976888-2.616889-4.361481-5.176889-8.391111-7.68-12.088889-2.503111-3.707259-4.190815-5.338074-5.063111-4.901926-0.872296 0.436148-2.180741 0.711111-3.925333 0.815407-1.744593 0.113778-3.489185 0-5.233778-0.32237-1.744593-0.32237-3.432296-0.929185-5.063111-1.792-1.621333-0.881778-2.768593-2.076444-3.422815-3.602963zM908.743111 480.199111c-4.361481 5.015704-9.045333 8.77037-14.051555 11.273482-5.015704 2.503111-9.699556 4.304593-14.051556 5.394963-5.233778 1.09037-10.24 1.526519-15.03763 1.308444-1.962667-3.053037-3.271111-6.542222-3.925333-10.458074-0.436148-3.489185-0.32237-7.841185 0.32237-13.074963 0.654222-5.224296 2.834963-11.548444 6.542223-18.953482 3.489185-7.186963 8.334222-12.695704 14.544592-16.507259 6.21037-3.811556 12.259556-6.58963 18.138074-8.334222 6.968889-1.962667 14.26963-2.939259 21.892741-2.939259-2.180741 3.925333-3.318519 7.898074-3.432296 11.927703-0.104296 4.02963-0.274963 8.173037-0.493037 12.420741-0.218074 4.247704-0.929185 8.713481-2.123852 13.397334-1.185185 4.683852-3.963259 9.528889-8.324741 14.544592z"
                  fill="#21A8DA"
                  p-id="1049"
                ></path>
                <path
                  d="M1108.110222 449.801481c4.361481 4.361481 7.575704 8.277333 9.642667 11.766519 2.066963 3.489185 3.432296 6.532741 4.086518 9.14963 0.872296 3.053037 0.976593 5.888 0.322371 8.495407-3.489185 1.526519-7.186963 2.616889-11.112297 3.271111-3.271111 0.436148-7.082667 0.493037-11.434666 0.161185-4.361481-0.32237-8.713481-1.687704-13.074963-4.086518-4.361481-2.180741-7.623111-4.740741-9.803852-7.68-2.180741-2.939259-3.982222-5.888-5.394963-8.827259-1.412741-2.939259-2.721185-5.831111-3.925333-8.656593-1.194667-2.834963-3.109926-5.338074-5.717334-7.518815 5.224296-2.180741 10.676148-3.593481 16.346074-4.247704 4.579556-0.436148 9.585778-0.218074 15.028149 0.654223 5.451852 0.872296 10.467556 3.375407 15.037629 7.518814zM866.578963 382.795852a71.282726 71.282726 0 0 1-19.285333-10.126222c-5.888-4.361481-11.008-8.609185-15.36-12.743111a131.190519 131.190519 0 0 1-13.729186-15.36c5.224296-5.669926 10.789926-9.699556 16.668445-12.098371 5.015704-2.180741 10.894222-2.996148 17.645037-2.446222 6.750815 0.540444 13.947259 4.304593 21.57037 11.273481 7.623111 7.186963 13.511111 13.293037 17.645037 18.29926 4.143407 5.015704 7.405037 9.045333 9.803852 12.088889 2.398815 3.707259 4.143407 6.750815 5.224296 9.149629-2.398815 2.180741-5.556148 3.707259-9.481481 4.579556-3.271111 0.872296-7.461926 1.251556-12.581926 1.147259-5.101037-0.113778-11.140741-1.365333-18.119111-3.764148z"
                  fill="#21A8DA"
                  p-id="1050"
                ></path>
                <path
                  d="M1100.923259 332.136296c11.112296-2.834963 19.825778-3.811556 26.149926-2.939259 6.314667 0.872296 11.226074 2.503111 14.705778 4.901926 3.925333 2.616889 6.646519 6.21037 8.173037 10.789926-2.834963 4.361481-6.21037 8.713481-10.135704 13.074963-3.271111 3.707259-7.300741 7.68-12.088889 11.927704s-10.24 7.898074-16.336592 10.951111c-6.106074 3.271111-11.766519 5.394963-16.990815 6.371555-5.233778 0.976593-9.974519 1.792-14.222222 2.455704-4.247704 0.654222-7.841185 1.744593-10.780445 3.271111-2.939259 1.526519-5.176889 4.361481-6.703407 8.495407-0.436148-10.894222 0.540444-21.029926 2.939259-30.397629 1.09037-3.925333 2.503111-7.898074 4.247704-11.927704a51.237926 51.237926 0 0 1 6.703407-11.273481c2.721185-3.489185 6.106074-6.58963 10.135704-9.310815 4.020148-2.740148 8.751407-4.864 14.203259-6.390519z"
                  fill="#E0A214"
                  p-id="1051"
                ></path>
              </svg>
            </div>
          </Link>
          {navBarTitle ? (
            <p className="ml-2 font-medium text-day dark:text-night header-name">
              {navBarTitle}
            </p>
          ) : (
            <p className="ml-2 font-medium text-day dark:text-night header-name">
              {BLOG.title},{' '}
              <span className="font-normal">{BLOG.description}</span>
            </p>
          )}
        </div>
        <NavBar />
      </div>
    </>
  );
};

export default Header;
